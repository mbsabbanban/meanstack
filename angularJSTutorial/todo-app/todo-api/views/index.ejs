<!DOCTYPE html>
<html ng-app="app">
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular-route.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular-resource.min.js"></script>

	<!--<script src="../app.js"></script>-->
  </head>
  <body>
    <h1><%= title %></h1>

		
	<ng-view></ng-view>
	
	<!-- Template -->
	<script type="text/ng-template" id="/todos.html">
	    Search: <input type="text" ng-model="search.name">
		<ul>
		    <li ng-repeat="todo in todos | filter: search">
			    <input type="checkbox" ng-model="todo.completed">
				<a href="#/{{$index}}">{{ todo.name }}</a>
			</li>
		</ul>
	</script>
	
	<script type="text/ng-template" id="/todoDetails.html">
	    <h1>{{ todo.name }}</h1>
		completed: <input type="checkbox" ng-model="todo.completed">
		note: <textarea>{{todo.note}}</textarea>
	</script>
	
	<script>

//----------
// Wiring up AngularJS
//----------

angular.module('app', ['ngRoute', 'ngResource'])

	//----------
	// Routes
	//----------
	
    .config(['$routeProvider', function($routeProvider){
		$routeProvider
		    .when('/', {
				templateUrl: '/todos.html',
				controller: 'TodoController'
			})
			
			.when('/:id', {
				templateUrl: '/todoDetails.html',
				controller: 'TodoDetailCtrl'
			})
	}])

/* OLD FACTORY WITH STATIC LIST
	.factory('Todos', function(){
		return [
			{ name: 'Master HTML/CSS/Javascript', completed: true, note: 'add notes...' },
			{ name: 'Learn AngularJS', completed: false, note: 'add notes...' },
			{ name: 'Build NodeJS backend', completed: false, note: 'add notes...' },
			{ name: 'Get started with ExpressJS', completed: false, note: 'add notes...' },
			{ name: 'Setup MongoDB database', completed: false, note: 'add notes...' },
			{ name: 'Be awesome!', completed: false, note: 'add notes...' }
		];
	})
*/

	.factory('Todos', ['$resource', function($resource){
		return $resource('/todos/:id', null, {
			'update': { method: 'PUT' }
		});
	}])
	

/* OLD CONTROLLER	
    .controller('TodoController', ['$scope', 'Todos', function($scope, Todos){
		$scope.todos = Todos;
	}])
*/

	.controller('TodoController', ['$scope','Todos', function($scope, Todos){
		$scope.todos = Todos.query();
	}])
	
	.controller('TodoDetailCtrl',['$scope', '$routeParams', 'Todos', function($scope, $routeParams, Todos){
		$scope.todo = Todos[$routeParams.id];
	}]);

	</script>
	
  </body>
</html>
